<h1 align="center">TEST DATA GENERATION</h1>

# Overview
In order to simplify the process of creation of an Alloy service, a best-effort automated test data generation functionality has been provided. This currently works for queries on models backed by relational mappings. 

Few important points to note before diving into the process:

- Automated test data generation will require you to provide seed data input (primary keys or any column values) for the root tables of the SQL query which gets generated. Once the initial seed is provided, data generation from other tables which are in the query is taken care of. If the seed data input is not known, there are some additional functionalities available to identify the seed. 

- Data is generated by running queries on the relational database with the connection information provided in the runtime of the service. So, the person creating the service must have access to the database (all of the tables which are accessed in the query).

- Since the resultant test data is actually a subset of the data present in the database, please ensure that there is no sensitive data in the result before committing the code or registering a service. There is a functionality which enables hashing all strings which come from the database which can be used in the case of sensitive data. If the hashStrings feature is not being used, this process should be done manually when dealing with sensitive data.


## Seed Data
seed data input is the input for primary keys or any column values of the root tables which the generated SQL query is based on, which is defined in `TableRowIdentifiers`.

``RowIdentifier``: 
A row identifier wraps many column to value mappings. It can be created using the below function. 

```
Class meta::protocols::pure::v1_18_0::metamodel::testDataGeneration::RowIdentifier
{
   columnValuePairs : meta::protocols::pure::v1_18_0::metamodel::testDataGeneration::ColumnValuePair[*];
}

Class meta::protocols::pure::v1_18_0::metamodel::testDataGeneration::ColumnValuePair
{
   name : String[1];
   value : Any[1];
}
```

`TableRowIdentifiers`: 
A table row identifier wraps many row identifiers as explained above and the table that is being dealt with. It can be created using the below function.
```
Class meta::protocols::pure::v1_18_0::metamodel::testDataGeneration::TableRowIdentfiiers
{
   table : meta::protocols::pure::v1_18_0::metamodel::store::relational::element::TablePtr[1];
   rowIdentifiers : meta::protocols::pure::v1_18_0::metamodel::testDataGeneration::RowIdentifier[*];
}
```

The seed data input will be transformed into `WHERE` clauses in SQL.

###Seed data generation (if root table keys are known)
If the root table is known, two functions below could be used to create seed input data with values that users prefer to manually generate test data.

```
function meta::relational::testDataGeneration::createTableRowIdentifiers(database: Database[1], schema: String[1], table: String[1], identifiers: RowIdentifier[*]):TableRowIdentifiers[1]
{
   createTableRowIdentifiers(getTable($database, $schema, $table), $identifiers);
}
```

Just as an example, if I am dealing with a query on the PersonTable model and I know that I am interested in name to generate the test data, I can create row identifiers in this manner.

```
function meta::relational::testDataGeneration::createTableRowIdentifiers(
 test::data::generation::TestDatabase, //Database,
 'UserStore', //Schema Name,
 'PersonTable', //Table Name,
 [
    meta::relational::testDataGeneration::createRowIdentifier(['NAME'], ['John']),
    meta::relational::testDataGeneration::createRowIdentifier(['NAME'], ['Tom'])
 ]
);
```


###Seed data generation (if root table keys are unknown)


There is a utility to generate seed data string which works for simple queries (not having unions and sub-queries).
You can run this function with the service and service parameters passed and this should generate a seed data string which can be directly copy pasted in the process of running automated test data generation algorithm.
```
function meta::relational::testDataGeneration::generateSeedDataString(func:FunctionDefinition<Any>[1], mapping:Mapping[1], runtime: Runtime[1], exeCtx: ExecutionContext[1], parameters: Any[*], extensions:Extension[*]):String[1]
```